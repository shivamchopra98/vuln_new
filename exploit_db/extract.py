# extract.py
import os
import requests
from datetime import datetime

def download_raw_csv(url, output_dir):
    """
    Download CSV and save it into output_dir with a date filename YYYY-MM-DD.csv.
    Returns the full path to the downloaded file.
    """
    # os.makedirs(output_dir, exist_ok=True)
    # today = datetime.now().strftime("%Y-%m-%d")
    # filename = f"{today}.csv"
    filename = "exploit_extract.csv"
    save_path = os.path.join(output_dir, filename)

    print(f"⬇️ Downloading CSV from {url} → {save_path}")
    resp = requests.get(url, stream=True, timeout=60)
    resp.raise_for_status()
    with open(save_path, "wb") as f:
        for chunk in resp.iter_content(chunk_size=8192):
            if chunk:
                f.write(chunk)
    print("✅ Download complete")
    return save_path
